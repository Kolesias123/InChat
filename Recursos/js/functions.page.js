/** * JavaScript - Página principal. * InfoSmart. Todos los derechos reservados. * * Copyright 2012 - Iván Bravo Bravo and jQuery Technology. * http://chat.infosmart.mx/ - http://www.jquery.com/**/var options = {	"smilies": "true",	"bbc": "true",	"wordsfilter": "true",	"social_buttons": "true"};var style = {};$(document).on("ready", function() {		if(Page == "new")	{		$("a[data-step]").on("click", selectRoom);		$("#chat-config").on("submit", setConfig);				$("#chat-style").on("submit", Finish);				$(".step img[data-background]").on("click", setBackground);				$("#box_background").ColorPicker({			onChange: function(hsb, hex, rgb) {					$("#box_background").val(rgb.r + "," + rgb.g + "," + rgb.b);			}		});				$("#font_color").ColorPicker({			onChange: function(hsb, hex, rgb) {					$("#font_color").val("#" + hex);			}		});				$("#box_trans").on("change", function() {			var val = $(this).val();						style['box_trans'] = parseFloat(val / 100);			$("#trans").html(val + "%");		});				$("#apply").on("click", Apply);						setTimeout(function() {			$("#recaptcha_response_field").attr("required", "required");		}, 1500);				updateRoom();	}		if(Page == "status")	{		try		{			var Serv = io.connect(Host);			Serv.disconnect();						$("#server").html("Funcionando").addClass("green");		}		catch(e) { $("#server").html("Apagado").addClass("red"); }			}		if(Page == "profile")	{		$("#gravatar").on("click", function() {			InfoAlerts.Show("", '<center>Por favor espere un momento...<br /><br /><img src="' + Resources_Sys + '/images/loading/animation.gif" /></center>', {'simple': true});						var email = $("#email").val();						$.post(Path + '/actions/gravatar.php', {'email': email}, function(img) {				$("#my_photo").attr("src", img);				InfoAlerts.Close();			});		});				$("#photo").on("change", function(e) {			K.ReadPhoto(e, "#my_photo");		});				$("#profile_nav li[data-to]").on("click", function() {			var section = $(this).attr("data-to");						showSection(section);		});	}		setInterval(getCount, 5000);});function showSection(id){	K.SetPath("", Path + "/profile?to=" + id);		$(".sections section").hide();	$(".sections section[data-section='" + id + "']").fadeIn("slow");}function getFacebookInfo(){	InfoAlerts.Show("", '<center>Por favor espere un momento...<br /><br /><img src="' + Resources_Sys + '/images/loading/animation.gif" /></center>', {'simple': true});		$.post(Path + '/actions/facebook.php', function(data) {		$("#username").val(data.username);		$("#name").val(html_entity_decode(data.name));		$("#email").val(data.email);		$("#facebookId").val(data.id);				$("#my_photo").attr("src", data.profile_image_url);				InfoAlerts.Close();	}, "json");}function selectRoom(){	var value = $(this).attr("data-value");	var step = $(this).attr("data-step");	var next = parseInt(step) + 1;		$(".step[data-step='" + next + "']").fadeIn("slow");	}function setConfig(){	$(this).stop();		options = GetValues("chat-config");	updateRoom();		$(".step[data-step='3']").fadeIn("slow");	return false;}function Finish(){	$(this).stop();		InfoAlerts.Show("", '<center>Por favor espere un momento...<br /><br /><img src="' + Resources_Sys + '/images/loading/animation.gif" /></center>', {'simple': true});		var settings = GetValues("chat-config");	var style = GetValues("chat-style");			$.post(Site + '/actions/add_room.php', {'settings': K.Json_encode(settings), 'style': K.Json_encode(style)}, function(html) {		var data = K.Json_decode(K.utf8_decode(html));				if(data.status == "OK")			document.location.href = Site + "/room/" + data.result;		else		{			$(".box-error").html(data.result);			K.ShowBox("error");						Recaptcha.reload();			document.location.href = "#error";		}					InfoAlerts.Close();	});		return false;}function setBackground(){	var background = $(this).attr("data-background");	$("#background").val("");		style['background'] = background;	updateRoom();}function updateRoom(){	var s = K.Json_encode(options);	var y = K.Json_encode(style);	var url = Site + "/chat?roomId=" + roomId + "&options=" + K.rawurlencode(s) + "&style=" + K.rawurlencode(y);		$(".mychat iframe").attr("src", url);	$("#chat-link").attr("href", url);}function Apply(){		var background = style['background'];	style = GetValues("chat-style");	style['background'] = background;		updateRoom();}function GetValues(id){	var values = { };		var name = "";	var value = "";	var back = "";		if(id == "chat-style")		back = style['background'];		$("#" + id + " input, #" + id + " textarea").each(function() {		name = $(this).attr("id");				if(name != undefined)		{			if($(this).attr("type") == "checkbox")			{				value = $("input#" + name + ":checked").val();								if(value == undefined)					value = "false";			}			else				value = $(this).val();		}					values[name] = value;	});		if(id == "chat-style" && back != undefined && back != "")		values['background'] = back;		return values;}function getCount(){	var users = $("#users_count").html();	var rooms = $("#rooms_count").html();		$.post(Site + '/actions/count.php?type=users', function(html) {		if(users == html)			return;				$("#users_count").fadeOut("slow", function() {			$("#users_count").html(html).fadeIn("slow");		});	});		$.post(Site + '/actions/count.php?type=rooms', function(html) {		if(rooms == html)			return;				$("#rooms_count").fadeOut("slow", function() {			$("#rooms_count").html(html).fadeIn("slow");		});	});}